name: REST CI
on: workflow_call

jobs:
  rest-ci:
    runs-on: ubuntu-latest

    steps:
      # If this workflow fails on the remote repository, this CI job will also fail.
      - name: Workflow dispatch to TileDB-REST-CI
        id: trigger-step
        uses: aurelien-baudet/workflow-dispatch@v2
        with:
          repo: TileDB-Inc/TileDB-REST-CI
          # Trigger workflow on TileDB-REST-CI at this ref.
          # TODO: Change to main TileDB-REST-CI branch.
          ref: "smr/sc-23785/rest-ci"
          workflow: Full CI
          # TODO: We could use a PAT or set repository deploy keys with public / private key pair.
          token: ${{ secrets.TILEDB_PAT }}
          # Pass TileDB core ref to test against REST.
          inputs: '{ "tiledb_ref": "${{ github.sha }}"}'
          display-workflow-run-url-interval: 30s
          wait-for-completion-interval: 30s
