<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Format version history</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../quarto-materials/tiledb.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../quarto-materials/tiledb-logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://tiledb.com"> 
<span class="menu-text">Home page</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://tiledb.com/contact"> 
<span class="menu-text">Contact us</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/TileDB-Inc/TileDB"> 
<span class="menu-text">Repo</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#format-version-history" id="toc-format-version-history" class="nav-link active" data-scroll-target="#format-version-history">Format Version History</a>
  <ul class="collapse">
  <li><a href="#version-22" id="toc-version-22" class="nav-link" data-scroll-target="#version-22">Version 22</a></li>
  <li><a href="#version-21" id="toc-version-21" class="nav-link" data-scroll-target="#version-21">Version 21</a></li>
  <li><a href="#version-20" id="toc-version-20" class="nav-link" data-scroll-target="#version-20">Version 20</a></li>
  <li><a href="#version-19" id="toc-version-19" class="nav-link" data-scroll-target="#version-19">Version 19</a></li>
  <li><a href="#version-18" id="toc-version-18" class="nav-link" data-scroll-target="#version-18">Version 18</a></li>
  <li><a href="#version-17" id="toc-version-17" class="nav-link" data-scroll-target="#version-17">Version 17</a></li>
  <li><a href="#version-16" id="toc-version-16" class="nav-link" data-scroll-target="#version-16">Version 16</a></li>
  <li><a href="#version-15" id="toc-version-15" class="nav-link" data-scroll-target="#version-15">Version 15</a></li>
  <li><a href="#version-14" id="toc-version-14" class="nav-link" data-scroll-target="#version-14">Version 14</a></li>
  <li><a href="#version-13" id="toc-version-13" class="nav-link" data-scroll-target="#version-13">Version 13</a></li>
  <li><a href="#version-12" id="toc-version-12" class="nav-link" data-scroll-target="#version-12">Version 12</a></li>
  <li><a href="#version-11" id="toc-version-11" class="nav-link" data-scroll-target="#version-11">Version 11</a></li>
  <li><a href="#version-10" id="toc-version-10" class="nav-link" data-scroll-target="#version-10">Version 10</a></li>
  <li><a href="#version-9" id="toc-version-9" class="nav-link" data-scroll-target="#version-9">Version 9</a></li>
  <li><a href="#version-8" id="toc-version-8" class="nav-link" data-scroll-target="#version-8">Version 8</a></li>
  <li><a href="#version-7" id="toc-version-7" class="nav-link" data-scroll-target="#version-7">Version 7</a></li>
  <li><a href="#version-6" id="toc-version-6" class="nav-link" data-scroll-target="#version-6">Version 6</a></li>
  <li><a href="#version-5" id="toc-version-5" class="nav-link" data-scroll-target="#version-5">Version 5</a></li>
  <li><a href="#version-4" id="toc-version-4" class="nav-link" data-scroll-target="#version-4">Version 4</a></li>
  <li><a href="#version-3" id="toc-version-3" class="nav-link" data-scroll-target="#version-3">Version 3</a></li>
  <li><a href="#version-2" id="toc-version-2" class="nav-link" data-scroll-target="#version-2">Version 2</a></li>
  <li><a href="#version-1" id="toc-version-1" class="nav-link" data-scroll-target="#version-1">Version 1</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Format version history</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="format-version-history" class="level1">
<h1>Format Version History</h1>
<section id="version-22" class="level2">
<h2 class="anchored" data-anchor-id="version-22">Version 22</h2>
<p>Introduced in TileDB 2.25</p>
<ul>
<li>The <em>Current domain</em> field was added to <a href="../format_spec/array_schema.html#array-schema-file">array schemas</a>.</li>
</ul>
</section>
<section id="version-21" class="level2">
<h2 class="anchored" data-anchor-id="version-21">Version 21</h2>
<p>Introduced in TileDB 2.19</p>
<ul>
<li>The TileDB implementation has been updated to fix computing <a href="../format_spec/fragment.html#tile-mins-maxes">tile metadata</a> for nullable fixed-size strings on dense arrays.</li>
</ul>
<blockquote class="blockquote">
<p>[!NOTE] This version does not contain any changes to the storage format, but was introduced as an indicator for implementations to not rely on tile metadata for nullable fixed-size strings on dense arrays on previous versions.</p>
</blockquote>
</section>
<section id="version-20" class="level2">
<h2 class="anchored" data-anchor-id="version-20">Version 20</h2>
<p>Introduced in TileDB 2.17</p>
<ul>
<li>Arrays can have <a href="../format_spec/enumeration.html">enumerations</a>.</li>
<li>The bit-width reduction and positive delta filters are supported on data of date or time types.</li>
<li>The <a href="../format_spec/filter_pipeline.html#filter-options">filter pipeline options</a> for the double-delta filter contain the <em>Reinterpret datatype</em> field.</li>
</ul>
</section>
<section id="version-19" class="level2">
<h2 class="anchored" data-anchor-id="version-19">Version 19</h2>
<p>Introduced in TileDB 2.16</p>
<ul>
<li><a href="../format_spec/vacuum_file.html">Vacuum files</a> contain relative paths to the location of the array.</li>
<li>The <a href="../format_spec/filter_pipeline.html#filter-options">filter pipeline options</a> for the delta filter contain the <em>Reinterpret datatype</em> field.</li>
</ul>
</section>
<section id="version-18" class="level2">
<h2 class="anchored" data-anchor-id="version-18">Version 18</h2>
<p>Introduced in TileDB 2.15</p>
<ul>
<li>Arrays can have <a href="../format_spec/array_schema.html#dimension-label">dimension labels</a>.</li>
</ul>
</section>
<section id="version-17" class="level2">
<h2 class="anchored" data-anchor-id="version-17">Version 17</h2>
<p>Introduced in TileDB 2.14</p>
<ul>
<li>The <em>Order</em> field was added to <a href="../format_spec/array_schema.html#attribute">attributes</a>.</li>
<li>Cell offsets in dimensions or attributes of UTF-8 string type are not written in the offset tiles, if the RLE or dictionary filter exists in the filter pipeline. They are instead encoded as part of the data tile.</li>
</ul>
</section>
<section id="version-16" class="level2">
<h2 class="anchored" data-anchor-id="version-16">Version 16</h2>
<p>Introduced in TileDB 2.12</p>
<ul>
<li>Arrays can have <a href="../format_spec/delete_commit_file.html">delete commit files</a>.</li>
<li>Arrays can have <a href="../format_spec/update_commit_file.html">update commit files</a>.
<ul>
<li>The TileDB implementation currently supports writing update commit files as an experimental feature, but they are not yet considered when performing reads.</li>
</ul></li>
<li>Fragment metadata contain <a href="../format_spec/fragment.html#tile-processed-conditions">tile processed conditions</a>.</li>
</ul>
</section>
<section id="version-15" class="level2">
<h2 class="anchored" data-anchor-id="version-15">Version 15</h2>
<p>Introduced in TileDB 2.11</p>
<ul>
<li>Consolidated fragments can have delete metadata files. The <em>Includes delete metadata</em> field was added to the <a href="../format_spec/fragment.html#footer">fragment metadata footer</a>.</li>
</ul>
</section>
<section id="version-14" class="level2">
<h2 class="anchored" data-anchor-id="version-14">Version 14</h2>
<p>Introduced in TileDB 2.10</p>
<ul>
<li>Consolidated fragments can have timestamp files. The <em>Includes timestamps</em> field was added to the <a href="../format_spec/fragment.html#footer">fragment metadata footer</a>.</li>
</ul>
</section>
<section id="version-13" class="level2">
<h2 class="anchored" data-anchor-id="version-13">Version 13</h2>
<p>Introduced in TileDB 2.9</p>
<ul>
<li>The <a href="../format_spec/filters/dictionary_encoding.html">dictionary filter</a> was added.</li>
</ul>
</section>
<section id="version-12" class="level2">
<h2 class="anchored" data-anchor-id="version-12">Version 12</h2>
<p>Introduced in TileDB 2.8</p>
<ul>
<li>The <a href="../format_spec/array_file_hierarchy.html">array file hierarchy</a> was updated to store fragments, commits and consolidated fragment metadata in separate subdirectories.</li>
<li>The extension of commit files was changed to <code>.wrt</code>.</li>
<li>Cell offsets in dimensions or attributes of ASCII string type are not written in the offset tiles, if the RLE filter exists in the filter pipeline. They are instead encoded as part of the data tile.</li>
</ul>
</section>
<section id="version-11" class="level2">
<h2 class="anchored" data-anchor-id="version-11">Version 11</h2>
<p>Introduced in TileDB 2.7</p>
<ul>
<li>Fragment metadata contain <a href="../format_spec/fragment.html#tile-mins-maxes">metadata</a> (min/max value, sum, null count) for each tile.</li>
<li>The TileDB implementation has been updated to never split cells when storing them in chunks.</li>
</ul>
</section>
<section id="version-10" class="level2">
<h2 class="anchored" data-anchor-id="version-10">Version 10</h2>
<p>Introduced in TileDB 2.4</p>
<ul>
<li>Arrays support schema evolution.
<ul>
<li>Array schemas are stored in a <code>__schema</code> subdirectory, and have a <a href="../format_spec/timestamped_name.html">timestamped name</a>.</li>
<li>The <em>Array schema name</em> field was added to the <a href="../format_spec/fragment.html#footer">fragment metadata footer</a>.</li>
</ul></li>
<li>The <em>Footer length</em> field of the <a href="../format_spec/fragment.html#footer">fragment metadata footer</a> is always written.</li>
</ul>
</section>
<section id="version-9" class="level2">
<h2 class="anchored" data-anchor-id="version-9">Version 9</h2>
<p>Introduced in TileDB 2.3</p>
<ul>
<li><a href="../format_spec/fragment.html#data-file">Data files</a> are named by the index of their attribute or dimension.</li>
<li>The <em>URI</em> fields of <a href="../format_spec/consolidated_fragment_metadata_file.html">Consolidated fragment metadata files</a> contain relative paths to the location of fragments in the array.</li>
</ul>
</section>
<section id="version-8" class="level2">
<h2 class="anchored" data-anchor-id="version-8">Version 8</h2>
<p>Introduced in TileDB 2.2.3</p>
<ul>
<li><a href="../format_spec/fragment.html#data-file">Data files</a> are named by the name of their attribute or dimension, after percent encoding certain characters. These characters are <code>!#$%&amp;'()*+,/:;=?@[]</code>, as specified in <a href="https://tools.ietf.org/html/rfc3986">RFC 3986</a>, as well as <code>"&lt;&gt;\|</code>, which are not allowed in Windows file names.</li>
</ul>
</section>
<section id="version-7" class="level2">
<h2 class="anchored" data-anchor-id="version-7">Version 7</h2>
<p>Introduced in TileDB 2.2</p>
<ul>
<li>Attributes can be nullable.
<ul>
<li>The <em>Nullable</em> and <em>Fill value validity</em> fields were added to <a href="../format_spec/array_schema.html#attribute">attributes</a>.</li>
<li>The <em>Validity filters</em> field was added to <a href="../format_spec/array_schema.html#array-schema-file">array schemas</a>.</li>
<li>Fragment metadata contain validity <a href="../format_spec/fragment.html#tile-offsets">tile offsets</a>.</li>
</ul></li>
</ul>
</section>
<section id="version-6" class="level2">
<h2 class="anchored" data-anchor-id="version-6">Version 6</h2>
<p>Introduced in TileDB 2.1</p>
<ul>
<li>The <em>Fill value</em> field was added to <a href="../format_spec/array_schema.html#attribute">attributes</a>.</li>
</ul>
</section>
<section id="version-5" class="level2">
<h2 class="anchored" data-anchor-id="version-5">Version 5</h2>
<p>Introduced in TileDB 2.0</p>
<ul>
<li>Dimensions are stored in separate <a href="../format_spec/fragment.html#data-file">data files</a>.</li>
<li>Sparse arrays can have string dimensions and dimensions with different datatypes.
<ul>
<li>The <em>Dimension datatype</em>, <em>Cell val num</em> and <em>Filters</em> fields were added to <a href="../format_spec/array_schema.html#dimension">dimensions</a>.</li>
<li>The <em>Domain size</em> field was added to <a href="../format_spec/array_schema.html#dimension">dimensions</a>. The domain of a dimension can have a variable size.</li>
<li>The <em>Domain datatype</em> field was removed from <a href="../format_spec/array_schema.html#domain">domains</a>.</li>
<li>The <a href="../format_spec/fragment.html#mbr">MBR</a> structure has been updated to support variable-sized dimensions.</li>
<li>The <em>Dimension number</em> and <em>R-Tree datatype</em> fields have been removed from <a href="../format_spec/fragment.html#r-tree">R-Trees</a>.</li>
</ul></li>
<li>The <em>Allows dups</em> field was added to <a href="../format_spec/array_schema.html#array-schema-file">array schemas</a>.</li>
<li>Committed fragments are indicated by the presence of an <code>.ok</code> file in the array’s directory, with the same <a href="../format_spec/timestamped_name.html">timestamped name</a> as the fragment.</li>
</ul>
</section>
<section id="version-4" class="level2">
<h2 class="anchored" data-anchor-id="version-4">Version 4</h2>
<p>Introduced in TileDB 1.7</p>
<ul>
<li>Support for the <a href="https://tiledb-inc-tiledb.readthedocs-hosted.com/en/1.6.3/tutorials/kv.html">key-value store</a> object type was removed. Key-value stores have been superseded by sparse arrays.</li>
</ul>
</section>
<section id="version-3" class="level2">
<h2 class="anchored" data-anchor-id="version-3">Version 3</h2>
<p>Introduced in TileDB 1.6</p>
<ul>
<li>The structure of <a href="../format_spec/fragment.html#fragment-metadata-file">fragment metadata files</a> was overhauled.
<ul>
<li>The <a href="../format_spec/fragment.html#footer">footer</a> and <a href="../format_spec/fragment.html#r-tree">R-Tree</a> structures were added.</li>
<li>The <em>Bounding coords</em> field was removed.</li>
<li>The <em>MBRs</em> field was removed. MBRs are now stored in the R-Tree.</li>
<li>Structures other than the footer like tile offsets, sizes and metadata are wrapped in their own generic tiles. This allows loading them lazily and in parallel.</li>
</ul></li>
</ul>
</section>
<section id="version-2" class="level2">
<h2 class="anchored" data-anchor-id="version-2">Version 2</h2>
<p>Introduced in TileDB 1.5</p>
<ul>
<li>Cell coordinate values of each dimension are always stored next to each other, regardless of whether they are filtered with a compression filter or not.</li>
</ul>
</section>
<section id="version-1" class="level2">
<h2 class="anchored" data-anchor-id="version-1">Version 1</h2>
<p>Introduced in TileDB 1.4</p>
<ul>
<li>Initial version of the TileDB storage format.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/TileDB-Inc\.github\.io\/TileDB\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>